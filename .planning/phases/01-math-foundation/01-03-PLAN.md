---
phase: 01-math-foundation
plan: 03
type: execute
wave: 1
depends_on: ["01-02"]
files_modified:
  - app/dashboard/exams/[examId]/grading/[attemptId]/GradingView.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Math displays identically in teacher grading view (GradingView)"
    - "Question content renders LaTeX expressions using KaTeX"
    - "Student answers render LaTeX expressions using KaTeX"
  artifacts:
    - path: "app/dashboard/exams/[examId]/grading/[attemptId]/GradingView.tsx"
      provides: "Teacher grading interface with math rendering"
      contains: "MathRenderer"
  key_links:
    - from: "GradingView.tsx"
      to: "components/exams/MathRenderer"
      via: "import statement"
      pattern: "import.*MathRenderer.*from.*@/components/exams/MathRenderer"
---

<objective>
Close verification gap: Add MathRenderer to GradingView for consistent math display.

Purpose: Teachers grading exams currently see raw text/JSON instead of rendered math expressions. This violates MATH-05 (consistent KaTeX rendering across all web surfaces).

Output: GradingView.tsx updated to render question content and student answers using MathRenderer component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-math-foundation/01-02-SUMMARY.md
@components/exams/MathRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MathRenderer to GradingView</name>
  <files>app/dashboard/exams/[examId]/grading/[attemptId]/GradingView.tsx</files>
  <action>
Update GradingView.tsx to use MathRenderer for displaying math content:

1. Add import at top of file:
   ```typescript
   import MathRenderer from '@/components/exams/MathRenderer'
   ```

2. Replace line 412 (question content display):
   Change from:
   ```tsx
   <div className="text-lg text-gray-900 font-medium mb-4">
       {question.content}
   </div>
   ```
   To:
   ```tsx
   <div className="text-lg text-gray-900 font-medium mb-4">
       <MathRenderer text={question.content} />
   </div>
   ```

3. Replace line 417 (student answer display):
   Change from:
   ```tsx
   <div className="text-gray-800 whitespace-pre-wrap">
       {question.answer?.segments.map(s => s.content).join('\n') || <span className="italic text-gray-400">No answer provided</span>}
   </div>
   ```
   To:
   ```tsx
   <div className="text-gray-800">
       {question.answer?.segments && question.answer.segments.length > 0 ? (
           question.answer.segments.map((s, i) => (
               <div key={s.id || i}>
                   <MathRenderer text={s.content} />
               </div>
           ))
       ) : (
           <span className="italic text-gray-400">No answer provided</span>
       )}
   </div>
   ```

Note: MathRenderer accepts `string | ContentSegment[]` and handles LaTeX detection and rendering internally. Each answer segment should be rendered separately to preserve structure.
  </action>
  <verify>
    1. `npm run build` completes without TypeScript errors
    2. Grep for MathRenderer import: `grep -n "MathRenderer" app/dashboard/exams/\[examId\]/grading/\[attemptId\]/GradingView.tsx` shows import and usage
    3. No raw `{question.content}` or `.join('\n')` patterns remain in the question/answer display area
  </verify>
  <done>
    - GradingView.tsx imports MathRenderer from '@/components/exams/MathRenderer'
    - Question content rendered via MathRenderer (line ~412)
    - Student answer segments rendered via MathRenderer (line ~417)
    - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
1. **Code verification:**
   - `grep -n "import MathRenderer" app/dashboard/exams/\[examId\]/grading/\[attemptId\]/GradingView.tsx` returns the import line
   - `grep -c "MathRenderer" app/dashboard/exams/\[examId\]/grading/\[attemptId\]/GradingView.tsx` returns 3+ (import + 2 usages)

2. **Build verification:**
   - `npm run build` succeeds without TypeScript errors

3. **Pattern verification:**
   - No `{question.content}` wrapped directly in div (should be in MathRenderer)
   - No `.join('\n')` for answer segments (should use MathRenderer per segment)
</verification>

<success_criteria>
1. Teachers viewing GradingView see rendered math (fractions, Greek letters, integrals) instead of raw LaTeX or plain text
2. Question content displays with KaTeX-rendered math expressions
3. Student answer segments display with KaTeX-rendered math expressions
4. Build passes without TypeScript errors
5. Visual parity: Math in GradingView matches math in ResultsView and editor preview
</success_criteria>

<output>
After completion, create `.planning/phases/01-math-foundation/01-03-SUMMARY.md`
</output>
