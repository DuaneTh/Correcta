---
phase: 11-verification-complete-pre-production
plan: 06
type: execute
wave: 3
depends_on: [11-02, 11-03]
files_modified:
  - app/layout.tsx
  - next.config.js
  - components/**/*.tsx
autonomous: false

must_haves:
  truths:
    - "All pages pass Lighthouse accessibility audit with score >= 80"
    - "All interactive elements are keyboard-navigable (tab, enter, escape)"
    - "All images have alt text attributes"
    - "All form inputs have associated labels"
    - "No WCAG AA color contrast violations on primary UI elements"
  artifacts:
    - path: "app/layout.tsx"
      provides: "Root layout with lang attribute and meta tags"
      contains: "lang="
  key_links:
    - from: "app/layout.tsx"
      to: "lib/i18n/config.ts"
      via: "Locale-based lang attribute"
      pattern: "lang"
---

<objective>
Audit performance optimization opportunities and accessibility compliance across all pages — fix critical issues that would fail Lighthouse or WCAG AA checks.

Purpose: Ensure acceptable page load times and basic accessibility compliance for an education platform.
Output: Accessible forms, keyboard navigation, proper alt text, lang attributes, and performance optimizations applied.
</objective>

<execution_context>
@C:\Users\hugol\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hugol\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/layout.tsx
@components/ui/Button.tsx
@components/ui/Form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix accessibility issues</name>
  <files>
    app/layout.tsx
    app/**/*.tsx
    components/**/*.tsx
  </files>
  <action>
**1. Root Layout Accessibility:**
Read `app/layout.tsx` and verify:
- `<html>` has `lang` attribute set dynamically based on locale (fr/en)
- If lang is hardcoded or missing: Add dynamic locale detection from cookie
- `<head>` includes viewport meta tag
- `<body>` has appropriate text sizing base

**2. Image Alt Text Audit:**
Search ALL `.tsx` files for `<img` and `<Image` tags (Next.js Image component).
For each:
- Verify `alt` attribute is present and meaningful (not empty string "")
- If decorative image: `alt=""` is acceptable but `role="presentation"` should be added
- If informational image: `alt` should describe the content
- Pay special attention to:
  - Question images in exam editor and taking views
  - User avatars (if any)
  - Logo/branding images

**3. Form Label Audit:**
Search for `<input`, `<select`, `<textarea` elements across all pages.
For each:
- Verify there is an associated `<label>` with `htmlFor` matching the input's `id`
- Or verify `aria-label` is provided as an alternative
- Or verify the input is inside a `<label>` element
- Pay special attention to:
  - Login form inputs
  - Exam answer inputs
  - Search fields
  - CSV upload inputs
  - Admin form inputs (user creation, course creation)

For inputs using UI Kit Form components: Verify the Form components themselves provide proper label association.

**4. Keyboard Navigation Audit:**
Check critical interactive flows:
- Modal dialogs: Must trap focus when open, return focus when closed. Check for `onKeyDown` handling of Escape key.
- Dropdown menus: Must support arrow key navigation
- Tab order: Verify `tabIndex` is not used incorrectly (negative values hiding interactive elements)
- Focus indicators: Verify `focus:ring` or `focus-visible:` styles exist on interactive elements

Specifically check:
- `components/ui/ConfirmModal.tsx` — focus trap and Escape key
- `components/ui/Drawer.tsx` — focus trap and Escape key
- Math toolbar buttons — keyboard accessible

**5. Color Contrast:**
Review the design tokens/colors used in UI Kit:
- `brand-900` on white background: Check if contrast ratio >= 4.5:1 (WCAG AA)
- Badge colors (green, red, orange, blue on white): Verify readability
- This is a code review only — check the actual hex values used

For each issue found, implement the fix directly.
  </action>
  <verify>
Grep for `<img` without `alt` — should return zero. Grep for `<input` without associated label or aria-label — should return zero. Verify `lang` attribute in layout. Run `npx tsc --noEmit`.
  </verify>
  <done>Root layout has dynamic lang attribute. All images have alt text. All form inputs have labels. Keyboard navigation verified on modals. TypeScript compiles.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Accessibility fixes applied: lang attribute on html, alt text on images, labels on form inputs, keyboard navigation on modals. Error boundaries and loading states from plan 11-03. UI Kit consistency from plan 11-05.
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Open Chrome DevTools → Lighthouse → Run accessibility audit on:
   - `/login` page (target: >= 80 accessibility score)
   - `/student/courses` page (target: >= 80)
   - `/teacher/courses` page (target: >= 80)
3. Test keyboard navigation:
   - Tab through login form — all fields reachable
   - Tab through exam editor — buttons and inputs reachable
   - Open a modal → Escape closes it → focus returns to trigger
4. Test error boundary:
   - Navigate to a non-existent URL (e.g., `/teacher/nonexistent`) → should show 404 page
5. Test language switcher:
   - Switch between FR and EN → all visible text should change, no raw key paths visible
6. Test empty states:
   - If possible, view a page with no data → should show EmptyState component
  </how-to-verify>
  <resume-signal>Type "approved" if accessibility and robustness checks pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Lighthouse accessibility score >= 80 on login page
3. All images have alt text (grep verification)
4. All form inputs have labels (grep verification)
5. Root layout has dynamic lang attribute
6. Keyboard navigation works on modals and forms
</verification>

<success_criteria>
- Root layout sets lang attribute based on locale
- All `<img>` / `<Image>` tags have meaningful alt text
- All form inputs have associated labels or aria-labels
- Modal dialogs support Escape key and focus trap
- Lighthouse accessibility score >= 80 on key pages
- No critical WCAG AA violations on primary UI elements
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/11-verification-complete-pre-production/11-06-SUMMARY.md`
</output>
