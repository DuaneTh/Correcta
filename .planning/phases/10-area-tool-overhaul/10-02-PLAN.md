---
phase: 10-area-tool-overhaul
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/exams/graph-editor/SimpleGraphEditor.tsx
  - components/exams/graph-editor/AreaPropertiesPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Teacher can select an area and see its properties in a panel"
    - "Teacher can change area color via color picker or preset colors"
    - "Teacher can change area opacity via slider (0-100%)"
    - "Teacher can edit area label text"
    - "Changes update the graph in real-time"
  artifacts:
    - path: "components/exams/graph-editor/AreaPropertiesPanel.tsx"
      provides: "Area customization UI (color, opacity, label)"
      exports: ["AreaPropertiesPanel"]
    - path: "components/exams/graph-editor/SimpleGraphEditor.tsx"
      provides: "Integration of AreaPropertiesPanel when area is selected"
      contains: "AreaPropertiesPanel"
  key_links:
    - from: "AreaPropertiesPanel.tsx"
      to: "SimpleGraphEditor.tsx"
      via: "Imported and rendered when selected.type === 'area'"
      pattern: "import.*AreaPropertiesPanel"
    - from: "AreaPropertiesPanel.tsx"
      to: "onChange callback"
      via: "Updates GraphPayload.areas array"
      pattern: "onUpdate.*area"
---

<objective>
Create an area properties panel for customizing area appearance (color, opacity, label) and integrate it into SimpleGraphEditor.

Purpose: Enables AREA-03 requirement - teacher can personalize area name, color, and opacity. Improves UX by providing visual feedback during customization.

Output: Working properties panel that appears when an area is selected, with real-time updates.
</objective>

<execution_context>
@C:\Users\hugol\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hugol\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@components/exams/graph-editor/SimpleGraphEditor.tsx
@components/exams/graph-editor/canvas/shapes/EditableArea.tsx
@types/exams.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AreaPropertiesPanel component</name>
  <files>components/exams/graph-editor/AreaPropertiesPanel.tsx</files>
  <action>
Create a new component `AreaPropertiesPanel.tsx` with the following features:

**Props:**
```typescript
interface AreaPropertiesPanelProps {
  area: GraphArea
  onUpdate: (updated: GraphArea) => void
  locale?: string
}
```

**UI Elements (vertical layout, compact):**

1. **Label section:**
   - Text input for area label (e.g., "A", "Region 1", or LaTeX like "\mathcal{A}")
   - Checkbox for "Math label" (labelIsMath)
   - Checkbox for "Show label" (showLabel)

2. **Color section:**
   - 6 preset color buttons in a row:
     - Purple (#8b5cf6) - default
     - Blue (#3b82f6)
     - Green (#22c55e)
     - Yellow (#eab308)
     - Red (#ef4444)
     - Gray (#6b7280)
   - Each button is a small colored square (20x20px), highlighted border when selected

3. **Opacity section:**
   - Range slider from 0 to 100 (maps to 0.0-1.0)
   - Display current percentage value
   - Default: 35%

**Styling:**
- Use Tailwind classes
- Compact design to fit in sidebar/bottom panel
- Section headers: text-xs font-medium text-gray-600 uppercase
- Inputs: text-sm, minimal borders

**Localization:**
- Support `locale` prop for French/English labels
- Labels: "Etiquette"/"Label", "Couleur"/"Color", "Opacite"/"Opacity"
- Math label: "Formule math"/"Math formula"
- Show label: "Afficher"/"Show"
  </action>
  <verify>
File exists and exports AreaPropertiesPanel component. TypeScript compiles without errors.
  </verify>
  <done>
AreaPropertiesPanel component renders color presets, opacity slider, and label inputs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate AreaPropertiesPanel into SimpleGraphEditor</name>
  <files>components/exams/graph-editor/SimpleGraphEditor.tsx</files>
  <action>
Modify SimpleGraphEditor to show AreaPropertiesPanel when an area is selected.

**Changes:**

1. **Import AreaPropertiesPanel:**
   ```typescript
   import { AreaPropertiesPanel } from './AreaPropertiesPanel'
   ```

2. **Add area update handler:**
   ```typescript
   const handleAreaUpdate = useCallback((updatedArea: GraphArea) => {
     const updated: GraphPayload = {
       ...value,
       areas: value.areas.map(a => a.id === updatedArea.id ? updatedArea : a)
     }
     onChange(updated)
   }, [value, onChange])
   ```

3. **Modify the mini properties bar section** (currently ~line 371-391):
   - When `selected.type === 'area'`, render AreaPropertiesPanel instead of the simple text display
   - Keep the delete button visible alongside the properties panel

4. **Layout adjustment:**
   - Replace the current single-line mini properties bar with a conditional:
     - If selected.type is NOT 'area': show current mini properties bar (unchanged)
     - If selected.type IS 'area': show AreaPropertiesPanel + delete button
   - Properties panel should be ~200px height max, scrollable if needed

**Why this approach:**
- Minimal changes to existing code
- Area gets special treatment because it has more customizable properties
- Other element types keep their simple display (points, lines, functions)
  </action>
  <verify>
```bash
# TypeScript compilation
npx tsc --noEmit

# Dev server starts
npm run dev
```
Select an area in SimpleGraphEditor, verify AreaPropertiesPanel appears. Change color/opacity, verify area updates visually.
  </verify>
  <done>
Selecting an area shows AreaPropertiesPanel. Color/opacity/label changes update the area in real-time.
  </done>
</task>

</tasks>

<verification>
1. Open SimpleGraphEditor (via exam builder or isolation)
2. Add a parabola function
3. Add an area (smart-area from palette)
4. Select the area
5. Verify AreaPropertiesPanel appears
6. Click different color presets - area fill changes immediately
7. Move opacity slider - area transparency changes
8. Edit label text - label updates on canvas
9. Toggle "Show label" - label appears/disappears
10. Toggle "Math label" - rendering style changes
</verification>

<success_criteria>
1. AreaPropertiesPanel component exists and renders correctly
2. Color picker shows 6 preset colors with selection highlight
3. Opacity slider works (0-100% range)
4. Label input works with math toggle
5. All changes update GraphPayload in real-time
6. UI is localized (French and English)
</success_criteria>

<output>
After completion, create `.planning/phases/10-area-tool-overhaul/10-02-SUMMARY.md`
</output>
